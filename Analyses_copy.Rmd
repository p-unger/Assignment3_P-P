---
title: "Analyses"
author: "Philip & Philipp"
date: "14 Apr 2016"
output: pdf_document
---

```{r, message=FALSE, include=FALSE}
# Load packages and create BibTeX file for R-packages
PackagesUsed <- c("ggplot2", "repmis", "plyr", "dplyr", "MASS", "Hmisc")

# Set working directory
#setwd("~/Documents/CDA/collaborative_projects/Assignment3_P-P") # Unger
setwd("~/R_data/Assignment3_P-P") # Staender

# Load PackagesUsed and create .bib BibTeX file
repmis::LoadandCite(PackagesUsed, file = "packages.bib", install = FALSE)
```

```{r}
if(!file.exists("data_final.rda")) {
  source('data_combine.R')
}

# Opens data_final.rda if not already loaded as an object
if(!exists("z.df" )) {
  load("data_final.rda")
}
```

## Descriptive results

Distribution of happiness variables !should probably be in a table! 

```{r}
satjob.freq <- table(z$satjob)

barplot(satjob.freq, 
        col=c("navyblue"),
        xlab = "Job satisfaction categories",
        legend = c("Job satisfcation"),
        ylim = c(0, 17000)
        )

sat.freq <- table(z$happy)

barplot(sat.freq, 
        col=c("navyblue"),
        xlab = "Overall life satisfaction categories",
        legend = c("Life satisfaction"),
        ylim = c(0, 20000)
)
```


# Distribution of work-hours for full-time workers
```{r}
hist(z$hrs1[z$working_ft==1],
     col=c("navyblue"),
     border = "White",
     xlab = "Hours worked last week (full-time employees)"
)   
```

# Happiness for women and men at different ages

```{r}
## Combined
t <- z
ggplot() + 
  stat_summary(data = t[t$sex == 1 & t$educat == 4,], aes(x=factor(age), y=vhappy), 
               fun.y="mean", geom="point", col="Navyblue") + 
  stat_summary(data = t[t$sex == 2 & t$educat == 4,], aes(x=factor(age), y=vhappy), 
               fun.y="mean", geom="point", col="Red") + 
  expand_limits(y=c(0.2,0.6)) +
  theme_bw()
```


# Happiness for women and men depending whether they have a career
```{r}
z = z[z$year >= 1977 & z$year < 2012,]

ggplot() + 
  stat_summary(data = z[z$sex == 1,], aes(x=factor(career), y=vhappy), 
               fun.y="mean", geom="point", col="Navyblue") + 
  stat_summary(data = z[z$sex == 2,], aes(x=factor(career), y=vhappy), 
               fun.y="mean", geom="point", col="Red") + 
  expand_limits(y=c(0.25,0.4)) +
  theme_bw()
```

# Happiness for women and men depending on combination of having a career and a family
```{r}
z$meanhap <- NA
z$meanhap[z$family==0 & z$career==0] <- "No career, no family"
z$meanhap[z$family==0 & z$career==1] <- "Career, no family"
z$meanhap[z$family==1 & z$career==0] <- "No career, family"
z$meanhap[z$family==1 & z$career==1] <- "Career, family"

table(z$meanhap)
describe(z$meanhap)

ggplot() + 
  stat_summary(data = z[z$sex == 1,], aes(x=factor(meanhap), y=vhappy), 
               fun.y="mean", geom="point", col="Navyblue") +
  stat_summary(data = z[z$sex == 2,], aes(x=factor(meanhap), y=vhappy), 
             fun.y="mean", geom="point", col="Red")
  theme_bw()
  
```

# Interaction effects of married*career for working men and women

```{r}

z$working_ft <- as.numeric(z$working_ft)
z$working_pt <- as.numeric(z$working_pt)

M1a <- lm(vhappy ~ career*married + age + agesq + as.factor(year) + as.factor(race) + as.factor(bdec), 
         data = subset(z, sex==2 & educat == 4))
M2a <- lm(vhappy ~ career*married + age + agesq + as.factor(year) + as.factor(race) + as.factor(bdec), 
          data = subset(z, sex==1 & educat == 4))

# compare men and women
require("gridExtra")

interM1 <- interplot(M1a, var1 = "married", var2 = "career") +
  ggtitle("Working women") +
  xlab("career") + 
  ylab("effect of marriage on life satisfaction") + 
  expand_limits(y=c(0.05,0.3)) +
  theme_bw()

interM2 <- interplot(M2a, var1 = "married", var2 = "career") +
  ggtitle("Working men") +
  xlab("career") + 
  expand_limits(y=c(0.05,0.3)) +
  theme_bw()

grid.arrange(interM1, interM2, ncol = 2) 

```

# Interaction effects of family*career for working men and women

```{r}

M3 <- lm(vhappy ~ career*family + age + agesq + as.factor(year) + as.factor(race) + as.factor(bdec), 
         data = subset(z, sex==2 & educat == 4))
M4 <- lm(vhappy ~ career*family + age + agesq + as.factor(year) + as.factor(race) + as.factor(bdec), 
         data = subset(z, sex==1 & educat == 4))

# Compare men and women (Career-Family interaction)

interM3 <- interplot(M3, var1 = "family", var2 = "career") +
  ggtitle("Working women") +
  xlab("career") + 
  ylab("effect of family on life satisfaction") + 
  expand_limits(y=c(0.05,0.3)) +
  theme_bw()

interM4 <- interplot(M4, var1 = "family", var2 = "career") +
  ggtitle("Working men") +
  xlab("career") + 
  expand_limits(y=c(0.05,0.3)) +
  theme_bw()

grid.arrange(interM3, interM4, ncol = 2) 
```

